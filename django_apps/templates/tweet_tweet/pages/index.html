{% extends 'base.html' %}

{% block head_title %}Home{% endblock head_title %}

{% block content %}
<div class="text-center mb-4"><h1>Welcome to Tweet Tweet</h1></div>

<div class="row">
    <div class="col-md-10 mx-auto mb-4 col-10">
        <form class="form" method="POST" action="tweets/create/"> {% csrf_token %}
            <input type="hidden" value="/" name="next" />
            <textarea class="form-control" name="content" placeholder="Your tweet goes here..."></textarea>
            <button type="submit" class="mt-4 btn btn-warning">Tweet</button>
        </form>
    </div>
</div>

<div id='tweets'>Loading...</div>

<script type="text/javascript">
    const tweetsElement = document.getElementById('tweets')

    const xhr = new XMLHttpRequest()
    const method = 'GET' // POST
    const url = 'tweets/' // name=list, method=tweet_list_view
    const responseType = 'json'

    xhr.responseType = responseType
    xhr.open(method, url)
    xhr.onload = () => {
        const serverResponse = xhr.response
        let listItems = serverResponse.response

        let formattedStr = ''
        for(let i=0;i<listItems.length;i++) {
            let listObj = listItems[i]
            formattedStr += formatTweetsContent(listObj)
        }
        tweetsElement.innerHTML = formattedStr
    }
    xhr.send()

    formatTweetsContent = (tweet) => {
        let formattedStr =
        `<div class="col-lg-12 col-md-10 py-3 border rounded mx-auto mb-4" id="tweet-${tweet.id}">`+
            `<p>${tweet.content}</p>`+
            likeBtn(tweet) +
        '</div>'
        return formattedStr
    }

    likeBtn = (tweet) => {
        let btn =
        `<button class='btn btn-danger btn-sm' id="like-${tweet.id}">${tweet.likes} Likes</button>`

        return btn
    }
</script>

{% endblock content %}